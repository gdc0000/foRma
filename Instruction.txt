Role: You are a Senior R Software Architect and a Quantitative Social Scientist specializing in Psychometrics. You are an expert in ggplot2, package development (using devtools/roxygen2), and computational geometry.

Project: You are tasked with building the core rendering engine for a new R package named 'foRma'.

Objective: Create a rule-based R library that transforms a specific JSON input (representing a Structural Equation Model) into a high-quality, publication-ready static image using only ggplot2 and ggforce.

Input Data:
The input is a strictly formatted JSON object (generated by an upstream AI agent). You do not need to calculate layout positions; the JSON already contains x and y coordinates for every node.

Nodes: Have id, label, type ("LATENT" vs "OBSERVED"), x, y, width, height.

Edges: Have sourceId, targetId, label (coefficient), isSignificant (bool), lineType ("straight" vs "curved").

Constraints & Requirements:

Dependencies: Use strictly CRAN packages: ggplot2, ggforce, jsonlite, dplyr, purrr. No system dependencies like Graphviz or Java.

Coordinate System: The JSON coordinates usually assume 
(
0
,
0
)
(0,0)
 is top-left. ggplot2 assumes 
(
0
,
0
)
(0,0)
 is bottom-left. You must handle scale_y_reverse() or coordinate inversion correctly.

Visual Semantics (Social Science Standard):

Latent Variables: Must be drawn as Ellipses.

Observed Variables: Must be drawn as Rectangles.

Regressions: Straight arrows with filled heads.

Covariances: Curved, double-headed arrows.

Significance: Significant paths are solid; non-significant are dashed.

Geometric Precision (Critical):

Arrows must not start/end at the center of the node 
(
ùë•
,
ùë¶
)
(x,y)
. They must stop exactly at the perimeter of the ellipse or rectangle.

You must implement a helper function to calculate the intersection point between a line segment and the node boundaries to ensure arrows look clean and disconnected from the text label.

Deliverables:

Please generate the file structure and code for the R package semviz.

1. DESCRIPTION File

Define the package metadata and dependencies.

2. R/utils_geometry.R

Implement the mathematical logic to calculate arrow start/end points.

Need a function calculate_intersection(x1, y1, x2, y2, node_type, width, height) that returns the coordinates on the node's perimeter.

3. R/parser.R

A function to read the JSON string/file and flatten it into two clean data frames (nodes_df and edges_df) ready for plotting.

4. R/renderer.R

The main function draw_sem(json_data) that builds the ggplot object layer by layer:

Layer 1: Edges (using geom_segment and geom_curve).

Layer 2: Edge Labels (using geom_label with white background).

Layer 3: Nodes (using geom_ellipse and geom_rect or ggforce equivalents).

Layer 4: Node Labels.

Theme: A clean, minimalist theme (theme_void modified) suitable for academic journals.

5. R/example.R

A simple script showing how to load the dummy JSON (provided below) and render the plot.

Reference Input JSON:

code
JSON
download
content_copy
expand_less
{
  "nodes": [
    {"id": "lat1", "x": 400, "y": 100, "label": "Factor A", "type": "LATENT", "width": 100, "height": 60},
    {"id": "obs1", "x": 300, "y": 300, "label": "Item 1", "type": "OBSERVED", "width": 80, "height": 50},
    {"id": "obs2", "x": 500, "y": 300, "label": "Item 2", "type": "OBSERVED", "width": 80, "height": 50}
  ],
  "edges": [
    {"id": "e1", "sourceId": "lat1", "targetId": "obs1", "label": "0.85", "isSignificant": true, "lineType": "straight"},
    {"id": "e2", "sourceId": "lat1", "targetId": "obs2", "label": "0.72", "isSignificant": true, "lineType": "straight"},
    {"id": "e3", "sourceId": "obs1", "targetId": "obs2", "label": "0.30", "isSignificant": false, "lineType": "curved"}
  ]
}

Let's build the package. Start coding.